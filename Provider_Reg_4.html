<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SOS Narva - Регистрация поставщика услуг</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body class="sos-page">

<!-- Sidebar -->
<div class="sos-sidebar" id="sidebar">
  <h4>Меню</h4>
  <a href="Provider_Reg_1.html">Регистрация поставщика услуг</a>
  <a href="#">Личный кабинет</a>
  <a href="#">Настройки</a>
  <a href="#">Условия пользования</a>
  <a href="#">Правила безопасности</a>
  <a href="#">Как начать работать</a>
  <a href="#">— для юр. лиц</a>
  <a href="#">— для физ. лиц</a>
  <a href="#">Контакты</a>
</div>
<div class="sos-overlay" id="overlay"></div>

<div class="phone-frame">

  <!-- Header -->
  <div class="sos-header">
    <a href="index.html" class="sos-logo">SOS Narva</a>
    <button class="sos-menu-btn" id="menuBtn">
      <svg class="sos-menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16M4 18h6"/>
      </svg>
    </button>
  </div>

  <!-- Company header -->
  <div class="sos-company-header" id="companyHeader">Multiweb OÜ &nbsp; 12102527</div>
  <br>

  <!-- Owner info -->
  <div id="ownerInfo" style="margin-bottom: 12px;">
    <div class="sos-form-label" style="margin-bottom: 6px;">Владелец</div>
    <div id="ownerNameText" style="margin-bottom: 6px;">—</div>
    <div id="ownerPhoneText" style="margin-bottom: 6px;">—</div>
    <div id="ownerEmailText" style="margin-bottom: 6px;">—</div>
  </div>

  <!-- Payment form -->
  <form id="paymentForm" autocomplete="off">

    <div class="sos-form-group">
      <label class="sos-form-label">
        <svg width="16" height="16" fill="none" stroke="red" viewBox="0 0 24 24">
          <rect x="1" y="4" width="22" height="16" rx="2" stroke-width="2"/>
          <line x1="1" y1="10" x2="23" y2="10" stroke-width="2"/>
        </svg>
        Добавьте карту <span class="sos-required-badge">обязательно</span>
      </label>

      <!-- Платежный блок как у тебя -->
      <div class="sos-card-section">
        <div class="sos-card-logos">
          <div class="sos-card-logo visa">VISA</div>
          <div class="sos-card-logo mastercard">MC</div>
          <div class="sos-card-logo amex">AMEX</div>
          <div class="sos-card-logo discover">DISC</div>
          <div class="sos-card-logo maestro">MAES</div>
          <div class="sos-card-logo diners">DIN</div>
          <div class="sos-card-logo jcb">JCB</div>
          <div class="sos-card-logo unionpay">UP</div>
        </div>

        <div class="sos-card-number-wrapper">
          <svg class="sos-card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="1" y="4" width="22" height="16" rx="2" stroke-width="2"/>
            <line x1="1" y1="10" x2="23" y2="10" stroke-width="2"/>
          </svg>

          <!-- НЕ сохраняем номер, только ввод -->
          <input
            type="text"
            id="cardNumber"
            class="sos-card-number-input"
            placeholder="0000 0000 0000 0000"
            maxlength="19"
            inputmode="numeric"
            autocomplete="off"
            required
          >

          <svg id="cardCheck" class="sos-check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
        </div>

        <div class="sos-card-details-row">
          <div class="sos-select-wrapper">
            <select id="expMonth" class="sos-form-select" required autocomplete="off">
              <option value="">Месяц</option>
              <option value="01">01</option><option value="02">02</option><option value="03">03</option>
              <option value="04">04</option><option value="05">05</option><option value="06">06</option>
              <option value="07">07</option><option value="08">08</option><option value="09">09</option>
              <option value="10">10</option><option value="11">11</option><option value="12">12</option>
            </select>
            <svg class="sos-select-arrow" width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>

          <div class="sos-select-wrapper">
            <select id="expYear" class="sos-form-select" required autocomplete="off">
              <option value="">Год</option>
              <option value="2024">2024</option><option value="2025">2025</option><option value="2026">2026</option>
              <option value="2027">2027</option><option value="2028">2028</option><option value="2029">2029</option>
              <option value="2030">2030</option><option value="2031">2031</option><option value="2032">2032</option>
              <option value="2033">2033</option>
            </select>
            <svg class="sos-select-arrow" width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>

          <!-- CVV вводим, но НЕ сохраняем -->
          <div class="sos-cvv-wrapper">
            <input
              type="text"
              id="cvv"
              class="sos-cvv-input"
              placeholder="CVV"
              maxlength="4"
              inputmode="numeric"
              autocomplete="off"
              required
            >
            <svg class="sos-cvv-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
          </div>
        </div>

        <div class="sos-security-badge">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
          Все данные надёжно защищены
        </div>
      </div>
    </div>

    <button type="submit" class="btn-sos-primary">Подтвердить</button>
  </form>

</div>

<script>
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  const menuBtn = document.getElementById("menuBtn");

  menuBtn.onclick = () => {
    sidebar.classList.add("active");
    overlay.classList.add("active");
  };

  overlay.onclick = () => {
    sidebar.classList.remove("active");
    overlay.classList.remove("active");
  };

  // Load company data
  const company = JSON.parse(localStorage.getItem("providerCompany") || "{}");
  if (company.companyName && company.regNumber) {
    document.getElementById("companyHeader").textContent = `${company.companyName}  ${company.regNumber}`;
  }

  // Load owner data
  const owner = JSON.parse(localStorage.getItem("providerOwner") || "{}");
  document.getElementById("ownerNameText").textContent = owner.ownerName ? owner.ownerName : "—";
  document.getElementById("ownerPhoneText").textContent = owner.phone ? owner.phone : "—";
  document.getElementById("ownerEmailText").textContent = owner.email ? owner.email : "—";

  // --- helpers ---
  function detectBrand(digits) {
    if (!digits) return "Card";
    if (digits.startsWith("4")) return "VISA";
    if (/^5[1-5]/.test(digits) || /^2(2[2-9]|[3-6]|7[01]|720)/.test(digits)) return "Mastercard";
    if (/^3[47]/.test(digits)) return "AMEX";
    if (/^6(011|5)/.test(digits)) return "Discover";
    if (/^(5018|5020|5038|56|57|58|6)/.test(digits)) return "Maestro";
    return "Card";
  }

  // Format & check
  const cardInput = document.getElementById("cardNumber");
  const cardCheck = document.getElementById("cardCheck");

  cardInput.addEventListener("input", e => {
    let val = e.target.value.replace(/\D/g, "").substring(0, 16);
    e.target.value = val.replace(/(\d{4})(?=\d)/g, "$1 ");
    cardCheck.classList.toggle("visible", val.length === 16);
  });

  document.getElementById("cvv").addEventListener("input", e => {
    e.target.value = e.target.value.replace(/\D/g, "").substring(0, 4);
  });

  // Submit: сохраняем ТОЛЬКО last4 + срок + бренд. Номер и CVV НЕ сохраняем.
  document.getElementById("paymentForm").addEventListener("submit", e => {
    e.preventDefault();

    const digits = cardInput.value.replace(/\D/g, "");
    const expMonth = document.getElementById("expMonth").value;
    const expYear = document.getElementById("expYear").value;

    const safe = {
      brand: detectBrand(digits),
      last4: digits.slice(-4),
      expMonth,
      expYear,
      ts: Date.now()
    };

    localStorage.setItem("providerPaymentSafe", JSON.stringify(safe));

    // На всякий случай: если где-то раньше ты сохранял providerPayment — сотрем
    localStorage.removeItem("providerPayment");

    window.location.href = "Provider_Reg_5.html";
  });
</script>

</body>
</html>
